version: '3.6'

# TODO Replace any javapi or dockerdonegal entry with your dockerhub account
services:
   sonarqube:
     image: sonarqube:latest
     hostname: sonarqube
     ports:
       - 9000:9000
     deploy:
       replicas: 1
       restart_policy:
         condition: any
     networks:
     - dd-network
     environment:
       - SONARQUBE_JDBC_USERNAME=sonar
       - SONARQUBE_JDBC_PASSWORD=sonar
     volumes:
       - sonarqube_conf:/opt/sonarqube/conf
       - sonarqube_data:/opt/sonarqube/data
       - sonarqube_extensions:/opt/sonarqube/extensions
       - sonarqube_bundled_plugins:/opt/sonarqube/lib/bundled-plugin

   jenkins:
     image: javapi/dd-jenkins:latest
     user: root
     ports:
       - 8080:8080
     deploy:
       replicas: 1
       restart_policy:
         condition: any
#     configs:
#       - source: jenkins-custom-credentials
#         target: /usr/share/jenkins/ref/init.groovy.d/custom.groovy
     networks:
     - dd-network
     volumes:
       - jenkins_home:/var/jenkins_home #Remember that, the tmp directory is designed to be wiped on system reboot.
       - /var/run/docker.sock:/var/run/docker.sock

   mongodb:
     image: javapi/dd-mongo:latest
     deploy:
       replicas: 1
       restart_policy:
         condition: any
     networks:
     - dd-network
     environment:
       - MONGO_DATA_DIR=/data/db
       - MONGO_LOG_DIR=/dev/null
       - APPLICATION_USER=ninja
       - APPLICATION_DATABASE=ninja
       - APPLICATION_PASS=ninja
       - MONGODB_ADMIN_USER=admin
       - MONGODB_ADMIN_PASS=admin
     volumes:
       - mongo:/data/db
     ports:
       - 27017:27017
     command: --smallfiles

networks:
  dd-network:
    external: true

volumes:
  jenkins_home:
  sonarqube_bundled_plugins:
  sonarqube_conf:
  sonarqube_data:
  sonarqube_extensions:
  mongo:

#configs:
#  jenkins-custom-credentials:
#    file: ./jenkins/custom.groovy